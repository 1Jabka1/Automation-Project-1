<!DOCTYPE html>
<html lang="en">
<head>
    <title>Cypress advanced registration from</title>
</head>
<body>
<h1>Registration form number 1</h1>
<nav>Home</nav>
<nav>Contacts</nav>
<div>
    <div>
        <p>This is simple registration form</p>
    </div>
</div>
<p>This is <span>simple</span> registration form</p>
<img src="cerebrum_hub_logo.png" width="178" height="166" alt="cerebrum_hub_logo">
<a href="https://cerebrumhub.com/">Cerebrum Hub homepage</a>

<form id="applicationForm">
    <h2>Input username</h2>
    <p>Username string should consist only of alphabetic and numeric characters</p>
    <label for="username">Username:</label>

    <!--Max length, and placeholder-->
    <input class="input" type="text" id="username" name="username" placeholder="Frank Abagnale" min="1" max="50"
           required
           onChange="checkInputPattern('username')" pattern='[a-zA-Z0-9_]+'>

    <h2>Phone number</h2>
    <p>Only numeric data can be used</p>
    <label for="phoneNumber">Phone number:</label>
    <input class="input" type="number" id="phoneNumber" data-testid="phoneNumberTestId" placeholder="8775048423"
           maxlength="10">

    <h2>Password section</h2>
    <p>NB! Passwords should match</p>
    <!--    Will also check that both passwords are similar-->
    <label>Password:
        <input class="input" name="password" type="password" onChange="onChange()" placeholder="Qwerty"/> </label><br/>
    <label>Confirm:
        <input class="input" name="confirm" type="password" onChange="onChange()" placeholder="Qwerty"/> </label><br/>
    <!--    Submit button, as part of form section - part of passwords validation as well-->
    <button class="submit_button" onclick="successMessage()">Submit</button>
    <p id="password_error_message">
            Passwords do not match!
    </p>
    <p id="input_error_message">
        Mandatory input field is not valid or empty!
    </p>
    <div id="success_message">
        <span class="close_button" onclick="this.parentElement.style.display='none';">&times;</span>
        User successfully submitted registration
    </div>
</form>
</body>
<script type="text/javascript">

    let submit_button = document.querySelector(".submit_button");
    submit_button.disabled = true;

    document.getElementById("success_message").style.display = "none"
    document.getElementById("password_error_message").style.display = "none"
    document.getElementById("input_error_message").style.display = "none"

    // Input fields should be only string or numbers
    function checkInputPattern(naming) {
        const element = document.querySelector(`input[name=${naming}]`);
        const pattern = element.getAttribute("pattern");
        const re = new RegExp(pattern);
        if (re.test(element.value)) {
            document.getElementById("input_error_message").style.display = "none"
            console.log('Input field has valid characters')
        } else {
            document.getElementById("input_error_message").style.display = "block"
            console.log('Input field has invalid character');
        }
    }

    // password and repeat password should be the same
    function onChange() {
        const password = document.querySelector('input[name=password]');
        const confirm = document.querySelector('input[name=confirm]');
        if (confirm.value === password.value) {
            document.getElementById("input_error_message").style.display = "none"
            console.log('Checked that passwords have same values - valid')
        } else {
            document.getElementById("input_error_message").style.display = "block"
            console.log('Passwords are different');
        }
    }

    Array.from(document.getElementsByTagName("input")).forEach(function (inputField) {
        inputField.addEventListener("change", stateHandle)
    })

    function stateHandle() {
        // Will check if all class .input fields
        if (document.querySelectorAll(".input:placeholder-shown").length === 0) {
            submit_button.disabled = false; //button is enabled
            console.log('Submit button will be enabled')
        } else {
            submit_button.disabled = true; //submit_button remains disabled
            console.log('Submit button will be disable')
        }
    }

    function successMessage() {
        // show new HTML part with success message
        document.getElementById("success_message").style.display = "block"
        console.log('Showing success message')
    }

    // This will imitate loading for 2 seconds, and success message will be still present until loading is finished
    const myForm = document.getElementById('applicationForm')
    myForm.addEventListener('submit', handleSubmit)
    let submitTimer

    function handleSubmit(event) {
        event.preventDefault()
        submitTimer = setTimeout(() => {
            this.submit()
            console.log('Submitted after 5 seconds')
        }, 2000)
    }

    function cancel() {
        clearTimeout(submitTimer);
        console.log('Submit Canceled')
    }

</script>

<style>
    /*Here will be CSS*/
    h2 {
        color: blue;
        font-weight: normal;
    }

    input:invalid {
        box-shadow: 0 0 5px 1px red;
    }

    input:focus:invalid {
        box-shadow: none;
    }
</style>
</html>